---
title: "Preparaci√≥n de datos"
date: "`r format(Sys.time(), '%A %d %B %Y %X')`"
output:
  html_document:
    toc: yes
    toc_float:
      collapsed: yes
      smooth_scroll: no
      number_sections: yes
    code_folding: hide
    number_sections: yes
editor_options:
  chunk_output_type: console
---
# Setup

```{r setup}
knitr::opts_chunk$set(
	echo = FALSE,
	results = "asis",
	message = FALSE,
	warning = FALSE, 
	fig.height = 18, 
	fig.width = 11, 
	cache = TRUE
)
options(scipen=9999) # desactivar notacion cientifica
remove(list = ls()) #limpieza del entorno de trabajo
```

```{css, echo=FALSE}
# /* expandir el espacio del documento*/
body .main-container {
      max-width: 1600px !important;
      width: 1600px !important;
    }
#/* expandir width de la TOC*/
div.tocify {
    width: 22% !important;
    max-width: 331px !important;
    max-height: 102% !important;
}
```

# Descriptive analysis

## Univariate

```{r tab-desc, results="asis", warning=FALSE}
rm(list=ls())
if (!require("pacman")) install.packages("pacman") # instalar pacman
                            # cargar librerias
pacman::p_load(dplyr,       # Manipulacion de datos
               knitr,
               kableExtra,
               summarytools
               )
load(file = here::here("input/data-proc/df_study_t5_ind_comunas.RData"))

# Css
st_css()
st_options(lang = "en",
           footnote = NA,
           bootstrap.css = F,
           custom.css = here::here("input/css/dfsummary.css"),
           dfSummary.custom.1 = NA
           )  

# Df variables nivel 1
# df<- dfSummary(df_study1_long %>% select(in_simpat:edad),
#                plain.ascii = FALSE,
#                style = "grid",
#                tmp.img.dir = "/tmp",
#                graph.magnif = TRUE,
#                headings = F,  # encabezado
#                varnumbers = F, # num variable
#                labels.col = T, # etiquetas
#                na.col = F,    # missing
#                graph.col = T, # plot
#                valid.col = T, # n valido
#                col.widths = c(700,10,10,10,10)
#                )
# df$Variable <- NULL # delete variable column
# view(df,
#      file = here::here("output/tables/desc01.html")
#      ) # Ver tabla en un archivo HTML
# webshot::webshot(url =here::here("output/tables/desc01.html"),
#         file =here::here("output/tables/desc01.png")) # Remover archivo HTML
# # print(df, method = "render")

# Df variables nivel 1 __________________________________________________________
df_study1 <- df_study_long_t5_comunas %>% select(in_simpat:edad,
                                                 inm_prop_cas17_w,
                                                 inm_prop_cas20_w,dif_inm) 
lab_study1 <- sjlabelled::get_label(df_study1) 
df_study1 <- df_study1 %>% na.omit() %>% sjlabelled::set_label(lab_study1)

df<- dfSummary(x = df_study1,
               plain.ascii = FALSE,
               style = "grid",
               tmp.img.dir = "/tmp",
               graph.magnif = TRUE,
               headings = F,  # encabezado
               varnumbers = F, # num variable
               labels.col = T, # etiquetas
               na.col = F,    # missing
               graph.col = T, # plot
               valid.col = T, # n valido
               col.widths = c(700,10,10,10,10,10)
               )
# df$Variable <- NULL # delete variable column
view(df,
     file = here::here("output/tables/desc02.html")
     ) # Ver tabla en un archivo HTML
webshot::webshot(url =here::here("output/tables/desc02.html"),
        file =here::here("output/tables/desc02.png")) # Remover archivo HTML
# print(df, method = "render")
```

## Correlation

```{r cor-plot, fig.dim=c(10,6)}
rm(list=ls())
if (!require("pacman")) install.packages("pacman") # instalar pacman
                            # cargar librerias
pacman::p_load(dplyr,       # Manipulacion de datos
               knitr,
               kableExtra,
               sjPlot,
               sjmisc,
               summarytools,
               lavaan
               )
load(file = here::here("input/data-proc/df_study_t5_ind_comunas.RData"))

# Full sample_______________________________________________________________________
mat_full<- 
df_study_long_t5_comunas %>%
  # filter(ola==1) %>%
  select(in_ansied,in_simpat,in_valfam, in_valami,in_amigcl, # conviviality
         in_simili,in_amsimb,in_acpier, in_acadop, # identity
         in_amreal # threat
         ) %>% 
  psych::mixedCor() 

cor_full <- as.matrix(mat_full$rho)
diag(cor_full) = NA #set diagonal values to NA
# Set Row names of the matrix
rownames(cor_full) <- c("A. Interaction anxiety with [PER/HAI/VEN]",
                     "B. Sympathy for [PER/HAI/VEN] living in Chile",
                     "C. Family value of immigrant friends [PER/HAI/VEN]",
                     "D. Friends value of immigrant friends [PER/HAI/VEN]",
                     "E. Immigrants [PER/HAI/VEN] have Chilean friends",
                     "F. Similarity between Chileans and [PER/HAI/VEN]",
                     "G. Loose of identity because of immigrants ",
                     "H. Immigrant keeping their customs",
                     "I. Adoption of Chilean customs",
                     "J. Unemployment increases")
#set Column names of the matrix
colnames(cor_full) <-c("(A)", "(B)","(C)","(D)","(E)","(F)","(G)","(H)","(I)","(J)")
#Plot the matrix using corrplot
corrplot::corrplot(cor_full,
  method = "color",
  addCoef.col = "#000390",
  type = "upper",
  tl.col = "black",
  col=colorRampPalette(c("white","#0068DC"))(12),
  bg = "white",
  na.label = "-",
  title = "\n Full sample")

# Wave 1_______________________________________________________________________
mat_1<- 
df_study_long_t5_comunas %>%
  filter(ola==1) %>%
  select(in_ansied,in_simpat,in_valfam, in_valami,in_amigcl, # conviviality
         in_simili,in_amsimb,in_acpier, in_acadop, # identity
         in_amreal # threat
         ) %>% 
  psych::mixedCor() 

cor_1 <- as.matrix(mat_1$rho)
diag(cor_1) = NA #set diagonal values to NA
# Set Row names of the matrix
rownames(cor_1) <- c("A. Interaction anxiety with [PER/HAI/VEN]",
                     "B. Sympathy for [PER/HAI/VEN] living in Chile",
                     "C. Family value of immigrant friends [PER/HAI/VEN]",
                     "D. Friends value of immigrant friends [PER/HAI/VEN]",
                     "E. Immigrants [PER/HAI/VEN] have Chilean friends",
                     "F. Similarity between Chileans and [PER/HAI/VEN]",
                     "G. Loose of identity because of immigrants ",
                     "H. Immigrant keeping their customs",
                     "I. Adoption of Chilean customs",
                     "J. Unemployment increases")
#set Column names of the matrix
colnames(cor_1) <-c("(A)", "(B)","(C)","(D)","(E)","(F)","(G)","(H)","(I)","(J)")
#Plot the matrix using corrplot
corrplot::corrplot(cor_1,
  method = "color",
  addCoef.col = "#000390",
  type = "upper",
  tl.col = "black",
  col=colorRampPalette(c("white","#0068DC"))(12),
  bg = "white",
  na.label = "-",
  title = "\n Wave 1")

# Wave 2_______________________________________________________________________
mat_2<-   
df_study_long_t5_comunas %>%
  filter(ola==2) %>% 
  select(in_ansied,in_simpat,in_valfam, in_valami,in_amigcl, # conviviality
         in_simili,in_amsimb,in_acpier, in_acadop, # identity
         in_amreal # threat
         ) %>% 
  psych::mixedCor() 

cor_2 <- as.matrix(mat_2$rho)
diag(cor_2) = NA #set diagonal values to NA
# Set Row names of the matrix
rownames(cor_2) <- c("A. Interaction anxiety with [PER/HAI/VEN]",
                     "B. Sympathy for [PER/HAI/VEN] living in Chile",
                     "C. Family value of immigrant friends [PER/HAI/VEN]",
                     "D. Friends value of immigrant friends [PER/HAI/VEN]",
                     "E. Immigrants [PER/HAI/VEN] have Chilean friends",
                     "F. Similarity between Chileans and [PER/HAI/VEN]",
                     "G. Loose of identity because of immigrants ",
                     "H. Immigrant keeping their customs",
                     "I. Adoption of Chilean customs",
                     "J. Unemployment increases")
#set Column names of the matrix
colnames(cor_2) <-c("(A)", "(B)","(C)","(D)","(E)","(F)","(G)","(H)","(I)","(J)")
#Plot the matrix using corrplot
corrplot::corrplot(cor_2,
  method = "color",
  addCoef.col = "#000390",
  type = "upper",
  tl.col = "black",
  col=colorRampPalette(c("white","#0068DC"))(12),
  bg = "white",
  na.label = "-",
  title = "\n Wave 2")


# Wave 3_______________________________________________________________________
mat_3 <- 
df_study_long_t5_comunas %>%
  filter(ola==3) %>% 
  select(in_ansied,in_simpat,in_valfam, in_valami,in_amigcl, # conviviality
         in_simili,in_amsimb,in_acpier, in_acadop, # identity
         in_amreal # threat
         ) %>% 
  psych::mixedCor()  

cor_3 <- as.matrix(mat_3$rho)
diag(cor_3) = NA #set diagonal values to NA
# Set Row names of the matrix
rownames(cor_3) <- c("A. Interaction anxiety with [PER/HAI/VEN]",
                     "B. Sympathy for [PER/HAI/VEN] living in Chile",
                     "C. Family value of immigrant friends [PER/HAI/VEN]",
                     "D. Friends value of immigrant friends [PER/HAI/VEN]",
                     "E. Immigrants [PER/HAI/VEN] have Chilean friends",
                     "F. Similarity between Chileans and [PER/HAI/VEN]",
                     "G. Loose of identity because of immigrants ",
                     "H. Immigrant keeping their customs",
                     "I. Adoption of Chilean customs",
                     "J. Unemployment increases")
#set Column names of the matrix
colnames(cor_3) <-c("(A)", "(B)","(C)","(D)","(E)","(F)","(G)","(H)","(I)","(J)")
#Plot the matrix using corrplot
corrplot::corrplot(cor_3,
  method = "color",
  addCoef.col = "#000390",
  type = "upper",
  tl.col = "black",
  col=colorRampPalette(c("white","#0068DC"))(12),
  bg = "white",
  na.label = "-",
  title = "\n Wave 3")

# Wave 4_______________________________________________________________________
mat_4 <- 
df_study_long_t5_comunas %>%
  filter(ola==4) %>% 
  select(in_ansied,in_simpat,in_valfam, in_valami,in_amigcl, # conviviality
         in_simili,in_amsimb,in_acpier, in_acadop, # identity
         in_amreal # threat
         ) %>% 
  psych::mixedCor() 


cor_4 <- as.matrix(mat_4$rho)
diag(cor_4) = NA #set diagonal values to NA
# Set Row names of the matrix
rownames(cor_4) <- c("A. Interaction anxiety with [PER/HAI/VEN]",
                     "B. Sympathy for [PER/HAI/VEN] living in Chile",
                     "C. Family value of immigrant friends [PER/HAI/VEN]",
                     "D. Friends value of immigrant friends [PER/HAI/VEN]",
                     "E. Immigrants [PER/HAI/VEN] have Chilean friends",
                     "F. Similarity between Chileans and [PER/HAI/VEN]",
                     "G. Loose of identity because of immigrants ",
                     "H. Immigrant keeping their customs",
                     "I. Adoption of Chilean customs",
                     "J. Unemployment increases")
#set Column names of the matrix
colnames(cor_4) <-c("(A)", "(B)","(C)","(D)","(E)","(F)","(G)","(H)","(I)","(J)")
#Plot the matrix using corrplot
corrplot::corrplot(cor_4,
  method = "color",
  addCoef.col = "#000390",
  type = "upper",
  tl.col = "black",
  col=colorRampPalette(c("white","#0068DC"))(12),
  bg = "white",
  na.label = "-",
  title = "\n Wave 4")


# Wave 5_______________________________________________________________________
mat_5 <- 
df_study_long_t5_comunas %>%
  filter(ola==5) %>% 
  select(in_ansied,in_simpat,in_valfam, in_valami,in_amigcl, # conviviality
         in_simili,in_amsimb,in_acpier, in_acadop, # identity
         in_amreal # threat
         ) %>% 
  psych::mixedCor() 

cor_5 <- as.matrix(mat_5$rho)
diag(cor_5) = NA #set diagonal values to NA
# Set Row names of the matrix
rownames(cor_5) <- c("A. Interaction anxiety with [PER/HAI/VEN]",
                     "B. Sympathy for [PER/HAI/VEN] living in Chile",
                     "C. Family value of immigrant friends [PER/HAI/VEN]",
                     "D. Friends value of immigrant friends [PER/HAI/VEN]",
                     "E. Immigrants [PER/HAI/VEN] have Chilean friends",
                     "F. Similarity between Chileans and [PER/HAI/VEN]",
                     "G. Loose of identity because of immigrants ",
                     "H. Immigrant keeping their customs",
                     "I. Adoption of Chilean customs",
                     "J. Unemployment increases")
#set Column names of the matrix
colnames(cor_5) <-c("(A)", "(B)","(C)","(D)","(E)","(F)","(G)","(H)","(I)","(J)")
#Plot the matrix using corrplot
corrplot::corrplot(cor_5,
  method = "color",
  addCoef.col = "#000390",
  type = "upper",
  tl.col = "black",
  col=colorRampPalette(c("white","#0068DC"))(12),
  bg = "white",
  na.label = "-",
  title = "\n Wave 5")
```

# Models

## A. Anxiety

```{r anxiety}
rm(list=ls())
if (!require("pacman")) install.packages("pacman") # instalar pacman
                            # cargar librerias
pacman::p_load(dplyr,       # Manipulacion de datos
               knitr,
               kableExtra,
               summarytools,
               lme4,
               texreg
               )
load(file = here::here("input/data-proc/df_study_t5_ind_comunas.RData"))

# generate analytical sample
df_study1 <- 
  df_study_long_t5_comunas %>%
  select(idencuesta,ola,comuna,cuestion_mig,in_simpat:edad,inm_prop_cas17_w,inm_prop_cas20_w,dif_inm) %>% 
  na.omit() %>% 
  mutate(conviviality=(in_ansied+in_simpat+in_valfam+in_valami+in_amigcl)/5,
         identity= (in_simili+in_amsimb+in_acpier+in_acadop)/4,
         threat = as.numeric(in_amreal),
         ola=as.numeric(ola)
         )
# Hipotesis
h1 <- "ola+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.educ <- "ola*educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.incom <- "ola+educ+quintil1*ola+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h3 <- "ola*dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.know <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4*ola+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.friend <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4*ola+pos_id+edad+dif_inm+nation_t1+cuestion_mig"

# A. Anxiety (in_ansied)
anx.null <- lmer(formula(paste0("in_ansied~","1 + (1|idencuesta)+(1|comuna)")),data = df_study1)
anx1 <- lmer(formula(paste0("in_ansied~",h1,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
anx2.ed <- lmer(formula(paste0("in_ansied~",h2.educ,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
anx2.in <- lmer(formula(paste0("in_ansied~",h2.incom,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
anx3 <- lmer(formula(paste0("in_ansied~",h3,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
anx4.kno <- lmer(formula(paste0("in_ansied~",h4.know,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
anx4.fri <- lmer(formula(paste0("in_ansied~",h4.friend,"+(1|idencuesta)+(1|comuna)")),data = df_study1)

omit <- "(pos_id)|(edad)|(cuestion_mig)|(nation_t1)|(quintil1QNA)|(Intercept)"
texreg::knitreg(list(anx1,anx2.ed,anx2.in,anx3,anx4.fri,anx4.kno),
          omit.coef = omit)
```

## B. Simpathy

```{r simpathy}
rm(list=ls())
if (!require("pacman")) install.packages("pacman") # instalar pacman
                            # cargar librerias
pacman::p_load(dplyr,       # Manipulacion de datos
               knitr,
               kableExtra,
               summarytools,
               lme4,
               texreg
               )
load(file = here::here("input/data-proc/df_study_t5_ind_comunas.RData"))

# generate analytical sample
df_study1 <- 
  df_study_long_t5_comunas %>%
  select(idencuesta,ola,comuna,cuestion_mig,in_simpat:edad,inm_prop_cas17_w,inm_prop_cas20_w,dif_inm) %>% 
  na.omit() %>% 
  mutate(conviviality=(in_ansied+in_simpat+in_valfam+in_valami+in_amigcl)/5,
         identity= (in_simili+in_amsimb+in_acpier+in_acadop)/4,
         threat = as.numeric(in_amreal),
         ola=as.numeric(ola)
         )
# Hipotesis
h1 <- "ola+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.educ <- "ola*educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.incom <- "ola+educ+quintil1*ola+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h3 <- "ola*dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.know <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4*ola+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.friend <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4*ola+pos_id+edad+dif_inm+nation_t1+cuestion_mig"

# B. Simpathy (in_simpat)
simp.null <- lmer(formula(paste0("in_simpat~","1 + (1|idencuesta)+(1|comuna)")),data = df_study1)
simp1 <- lmer(formula(paste0("in_simpat~",h1,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
simp2.ed <- lmer(formula(paste0("in_simpat~",h2.educ,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
simp2.in <- lmer(formula(paste0("in_simpat~",h2.incom,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
simp3 <- lmer(formula(paste0("in_simpat~",h3,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
simp4.kno <- lmer(formula(paste0("in_simpat~",h4.know,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
simp4.fri <- lmer(formula(paste0("in_simpat~",h4.friend,"+(1|idencuesta)+(1|comuna)")),data = df_study1)

omit <- "(pos_id)|(edad)|(cuestion_mig)|(nation_t1)|(quintil1QNA)|(Intercept)"
texreg::knitreg(list(simp1,simp2.ed,simp2.in,simp3,simp4.fri,simp4.kno),
          omit.coef = omit)
```

## C. Family value migrant friends

```{r family-value}
rm(list=ls())
if (!require("pacman")) install.packages("pacman") # instalar pacman
                            # cargar librerias
pacman::p_load(dplyr,       # Manipulacion de datos
               knitr,
               kableExtra,
               summarytools,
               lme4,
               texreg
               )
load(file = here::here("input/data-proc/df_study_t5_ind_comunas.RData"))

# generate analytical sample
df_study1 <- 
  df_study_long_t5_comunas %>%
  select(idencuesta,ola,comuna,cuestion_mig,in_simpat:edad,inm_prop_cas17_w,inm_prop_cas20_w,dif_inm) %>% 
  na.omit() %>% 
  mutate(conviviality=(in_ansied+in_simpat+in_valfam+in_valami+in_amigcl)/5,
         identity= (in_simili+in_amsimb+in_acpier+in_acadop)/4,
         threat = as.numeric(in_amreal),
         ola=as.numeric(ola)
         )
# Hipotesis
h1 <- "ola+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.educ <- "ola*educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.incom <- "ola+educ+quintil1*ola+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h3 <- "ola*dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.know <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4*ola+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.friend <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4*ola+pos_id+edad+dif_inm+nation_t1+cuestion_mig"

# C. Family value migrant friends (in_simpat)
valfam.null <- lmer(formula(paste0("in_valfam~","1 + (1|idencuesta)+(1|comuna)")),data = df_study1)
valfam1 <- lmer(formula(paste0("in_valfam~",h1,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
valfam2.ed <- lmer(formula(paste0("in_valfam~",h2.educ,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
valfam2.in <- lmer(formula(paste0("in_valfam~",h2.incom,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
valfam3 <- lmer(formula(paste0("in_valfam~",h3,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
valfam4.kno <- lmer(formula(paste0("in_valfam~",h4.know,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
valfam4.fri <- lmer(formula(paste0("in_valfam~",h4.friend,"+(1|idencuesta)+(1|comuna)")),data = df_study1)

omit <- "(pos_id)|(edad)|(cuestion_mig)|(nation_t1)|(quintil1QNA)|(Intercept)"
texreg::knitreg(list(valfam1,valfam2.ed,valfam2.in,valfam3,valfam4.fri,valfam4.kno),
          omit.coef = omit)
```

## D. Friend value migrant friends

```{r friends-value}
rm(list=ls())
if (!require("pacman")) install.packages("pacman") # instalar pacman
                            # cargar librerias
pacman::p_load(dplyr,       # Manipulacion de datos
               knitr,
               kableExtra,
               summarytools,
               lme4,
               texreg
               )
load(file = here::here("input/data-proc/df_study_t5_ind_comunas.RData"))

# generate analytical sample
df_study1 <- 
  df_study_long_t5_comunas %>%
  select(idencuesta,ola,comuna,cuestion_mig,in_simpat:edad,inm_prop_cas17_w,inm_prop_cas20_w,dif_inm) %>% 
  na.omit() %>% 
  mutate(conviviality=(in_ansied+in_simpat+in_valfam+in_valami+in_amigcl)/5,
         identity= (in_simili+in_amsimb+in_acpier+in_acadop)/4,
         threat = as.numeric(in_amreal),
         ola=as.numeric(ola)
         )
# Hipotesis
h1 <- "ola+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.educ <- "ola*educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.incom <- "ola+educ+quintil1*ola+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h3 <- "ola*dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.know <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4*ola+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.friend <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4*ola+pos_id+edad+dif_inm+nation_t1+cuestion_mig"

# D. Friend value migrant friends(in_simpat)
valami.null <- lmer(formula(paste0("in_valami~","1 + (1|idencuesta)+(1|comuna)")),data = df_study1)
valami1 <- lmer(formula(paste0("in_valami~",h1,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
valami2.ed <- lmer(formula(paste0("in_valami~",h2.educ,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
valami2.in <- lmer(formula(paste0("in_valami~",h2.incom,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
valami3 <- lmer(formula(paste0("in_valami~",h3,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
valami4.kno <- lmer(formula(paste0("in_valami~",h4.know,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
valami4.fri <- lmer(formula(paste0("in_valami~",h4.friend,"+(1|idencuesta)+(1|comuna)")),data = df_study1)

omit <- "(pos_id)|(edad)|(cuestion_mig)|(nation_t1)|(quintil1QNA)|(Intercept)"
texreg::knitreg(list(valami1,valami2.ed,valami2.in,valami3,valami4.fri,valami4.kno),
          omit.coef = omit)
```

## E. Immigrants have Chilean friends 

```{r imig-clfriends}
rm(list=ls())
if (!require("pacman")) install.packages("pacman") # instalar pacman
                            # cargar librerias
pacman::p_load(dplyr,       # Manipulacion de datos
               knitr,
               kableExtra,
               summarytools,
               lme4,
               texreg
               )
load(file = here::here("input/data-proc/df_study_t5_ind_comunas.RData"))

# generate analytical sample
df_study1 <- 
  df_study_long_t5_comunas %>%
  select(idencuesta,ola,comuna,cuestion_mig,in_simpat:edad,inm_prop_cas17_w,inm_prop_cas20_w,dif_inm) %>% 
  na.omit() %>% 
  mutate(conviviality=(in_ansied+in_simpat+in_valfam+in_valami+in_amigcl)/5,
         identity= (in_simili+in_amsimb+in_acpier+in_acadop)/4,
         threat = as.numeric(in_amreal),
         ola=as.numeric(ola)
         )
# Hipotesis
h1 <- "ola+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.educ <- "ola*educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.incom <- "ola+educ+quintil1*ola+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h3 <- "ola*dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.know <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4*ola+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.friend <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4*ola+pos_id+edad+dif_inm+nation_t1+cuestion_mig"

# E. Immigrants have Chilean friends 
amicl.null <- lmer(formula(paste0("in_amigcl~","1 + (1|idencuesta)+(1|comuna)")),data = df_study1)

amicl1 <- lmer(formula(paste0("in_amigcl~",h1,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
amicl2.ed <- lmer(formula(paste0("in_amigcl~",h2.educ,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
amicl2.in <- lmer(formula(paste0("in_amigcl~",h2.incom,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
amicl3 <- lmer(formula(paste0("in_amigcl~",h3,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
amicl4.kno <- lmer(formula(paste0("in_amigcl~",h4.know,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
amicl4.fri <- lmer(formula(paste0("in_amigcl~",h4.friend,"+(1|idencuesta)+(1|comuna)")),data = df_study1)

omit <- "(pos_id)|(edad)|(cuestion_mig)|(nation_t1)|(quintil1QNA)|(Intercept)"
texreg::knitreg(list(amicl1,amicl2.ed,amicl2.in,amicl3,amicl4.fri,amicl4.kno),
          omit.coef = omit)
```

## Conviviality (average)

```{r conviviality}
rm(list=ls())
if (!require("pacman")) install.packages("pacman") # instalar pacman
                            # cargar librerias
pacman::p_load(dplyr,       # Manipulacion de datos
               knitr,
               kableExtra,
               summarytools,
               lme4,
               texreg
               )
load(file = here::here("input/data-proc/df_study_t5_ind_comunas.RData"))

# generate analytical sample
df_study1 <- 
  df_study_long_t5_comunas %>%
  select(idencuesta,ola,comuna,cuestion_mig,in_simpat:edad,inm_prop_cas17_w,inm_prop_cas20_w,dif_inm) %>% 
  na.omit() %>% 
  mutate(conviviality=(in_ansied+in_simpat+in_valfam+in_valami+in_amigcl)/5,
         identity= (in_simili+in_amsimb+in_acpier+in_acadop)/4,
         threat = as.numeric(in_amreal),
         ola=as.numeric(ola)
         )

# Hipotesis
h1 <- "ola+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.educ <- "ola*educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.incom <- "ola+educ+quintil1*ola+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h3 <- "ola*dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.know <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4*ola+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.friend <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4*ola+pos_id+edad+dif_inm+nation_t1+cuestion_mig"

# E. Immigrants have Chilean friends 
conv.null <- lmer(formula(paste0("conviviality~","1 + (1|idencuesta)+(1|comuna)")),data = df_study1)
conv1 <- lmer(formula(paste0("conviviality~",h1,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
conv2.ed <- lmer(formula(paste0("conviviality~",h2.educ,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
conv2.in <- lmer(formula(paste0("conviviality~",h2.incom,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
conv3 <- lmer(formula(paste0("conviviality~",h3,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
conv4.kno <- lmer(formula(paste0("conviviality~",h4.know,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
conv4.fri <- lmer(formula(paste0("conviviality~",h4.friend,"+(1|idencuesta)+(1|comuna)")),data = df_study1)

omit <- "(pos_id)|(edad)|(cuestion_mig)|(nation_t1)|(quintil1QNA)|(Intercept)"
texreg::knitreg(list(conv1,conv2.ed,conv2.in,conv3,conv4.fri,conv4.kno),
          omit.coef = omit)
```

## F. Similarity 

```{r similarity}
rm(list=ls())
if (!require("pacman")) install.packages("pacman") # instalar pacman
                            # cargar librerias
pacman::p_load(dplyr,       # Manipulacion de datos
               knitr,
               kableExtra,
               summarytools,
               lme4,
               texreg
               )
load(file = here::here("input/data-proc/df_study_t5_ind_comunas.RData"))

# generate analytical sample
df_study1 <- 
  df_study_long_t5_comunas %>%
  select(idencuesta,ola,comuna,cuestion_mig,in_simpat:edad,inm_prop_cas17_w,inm_prop_cas20_w,dif_inm) %>% 
  na.omit() %>% 
  mutate(conviviality=(in_ansied+in_simpat+in_valfam+in_valami+in_amigcl)/5,
         identity= (in_simili+in_amsimb+in_acpier+in_acadop)/4,
         threat = as.numeric(in_amreal),
         ola=as.numeric(ola)
         )

# Hipotesis
h1 <- "ola+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.educ <- "ola*educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.incom <- "ola+educ+quintil1*ola+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h3 <- "ola*dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.know <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4*ola+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.friend <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4*ola+pos_id+edad+dif_inm+nation_t1+cuestion_mig"

# F. Similarity  
simi.null <- lmer(formula(paste0("in_simili~","1 + (1|idencuesta)+(1|comuna)")),data = df_study1)

simi1 <- lmer(formula(paste0("in_simili~",h1,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
simi2.ed <- lmer(formula(paste0("in_simili~",h2.educ,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
simi2.in <- lmer(formula(paste0("in_simili~",h2.incom,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
simi3 <- lmer(formula(paste0("in_simili~",h3,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
simi4.kno <- lmer(formula(paste0("in_simili~",h4.know,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
simi4.fri <- lmer(formula(paste0("in_simili~",h4.friend,"+(1|idencuesta)+(1|comuna)")),data = df_study1)

omit <- "(pos_id)|(edad)|(cuestion_mig)|(nation_t1)|(quintil1QNA)|(Intercept)"
texreg::knitreg(list(simi1,simi2.ed,simi2.in,simi3,simi4.fri,simi4.kno),
          omit.coef = omit)
```

## G. Loose identity

```{r loose-id}
rm(list=ls())
if (!require("pacman")) install.packages("pacman") # instalar pacman
                            # cargar librerias
pacman::p_load(dplyr,       # Manipulacion de datos
               knitr,
               kableExtra,
               summarytools,
               lme4,
               texreg
               )
load(file = here::here("input/data-proc/df_study_t5_ind_comunas.RData"))

# generate analytical sample
df_study1 <- 
  df_study_long_t5_comunas %>%
  select(idencuesta,ola,comuna,cuestion_mig,in_simpat:edad,inm_prop_cas17_w,inm_prop_cas20_w,dif_inm) %>% 
  na.omit() %>% 
  mutate(conviviality=(in_ansied+in_simpat+in_valfam+in_valami+in_amigcl)/5,
         identity= (in_simili+in_amsimb+in_acpier+in_acadop)/4,
         threat = as.numeric(in_amreal),
         ola=as.numeric(ola)
         )

# Hipotesis
h1 <- "ola+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.educ <- "ola*educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.incom <- "ola+educ+quintil1*ola+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h3 <- "ola*dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.know <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4*ola+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.friend <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4*ola+pos_id+edad+dif_inm+nation_t1+cuestion_mig"

## G. Loose identity
loos.null <- lmer(formula(paste0("in_amsimb~","1 + (1|idencuesta)+(1|comuna)")),data = df_study1)

loos1 <- lmer(formula(paste0("in_amsimb~",h1,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
loos2.ed <- lmer(formula(paste0("in_amsimb~",h2.educ,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
loos2.in <- lmer(formula(paste0("in_amsimb~",h2.incom,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
loos3 <- lmer(formula(paste0("in_amsimb~",h3,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
loos4.kno <- lmer(formula(paste0("in_amsimb~",h4.know,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
loos4.fri <- lmer(formula(paste0("in_amsimb~",h4.friend,"+(1|idencuesta)+(1|comuna)")),data = df_study1)

omit <- "(pos_id)|(edad)|(cuestion_mig)|(nation_t1)|(quintil1QNA)|(Intercept)"
texreg::knitreg(list(loos1,loos2.ed,loos2.in,loos3,loos4.fri,loos4.kno),
          omit.coef = omit)
```

## H. Immigrants keep customs

```{r keep-custom}
rm(list=ls())
if (!require("pacman")) install.packages("pacman") # instalar pacman
                            # cargar librerias
pacman::p_load(dplyr,       # Manipulacion de datos
               knitr,
               kableExtra,
               summarytools,
               lme4,
               texreg
               )
load(file = here::here("input/data-proc/df_study_t5_ind_comunas.RData"))

# generate analytical sample
df_study1 <- 
  df_study_long_t5_comunas %>%
  select(idencuesta,ola,comuna,cuestion_mig,in_simpat:edad,inm_prop_cas17_w,inm_prop_cas20_w,dif_inm) %>% 
  na.omit() %>% 
  mutate(conviviality=(in_ansied+in_simpat+in_valfam+in_valami+in_amigcl)/5,
         identity= (in_simili+in_amsimb+in_acpier+in_acadop)/4,
         threat = as.numeric(in_amreal),
         ola=as.numeric(ola))

# Hipotesis
h1 <- "ola+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.educ <- "ola*educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.incom <- "ola+educ+quintil1*ola+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h3 <- "ola*dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.know <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4*ola+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.friend <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4*ola+pos_id+edad+dif_inm+nation_t1+cuestion_mig"

# H. Immigrants keep customs  
keep.null <- lmer(formula(paste0("in_acpier~","1 + (1|idencuesta)+(1|comuna)")),data = df_study1)

keep1 <- lmer(formula(paste0("in_acpier~",h1,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
keep2.ed <- lmer(formula(paste0("in_acpier~",h2.educ,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
keep2.in <- lmer(formula(paste0("in_acpier~",h2.incom,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
keep3 <- lmer(formula(paste0("in_acpier~",h3,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
keep4.kno <- lmer(formula(paste0("in_acpier~",h4.know,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
keep4.fri <- lmer(formula(paste0("in_acpier~",h4.friend,"+(1|idencuesta)+(1|comuna)")),data = df_study1)

omit <- "(pos_id)|(edad)|(cuestion_mig)|(nation_t1)|(quintil1QNA)|(Intercept)"
texreg::knitreg(list(keep1,keep2.ed,keep2.in,keep3,keep4.fri,keep4.kno),
          omit.coef = omit)
```

## I. Adopt chilean customs

```{r}
rm(list=ls())
if (!require("pacman")) install.packages("pacman") # instalar pacman
                            # cargar librerias
pacman::p_load(dplyr,       # Manipulacion de datos
               knitr,
               kableExtra,
               summarytools,
               lme4,
               texreg
               )
load(file = here::here("input/data-proc/df_study_t5_ind_comunas.RData"))

# generate analytical sample
df_study1 <- 
  df_study_long_t5_comunas %>%
  select(idencuesta,ola,comuna,cuestion_mig,in_simpat:edad,inm_prop_cas17_w,inm_prop_cas20_w,dif_inm) %>% 
  na.omit() %>% 
  mutate(conviviality=(in_ansied+in_simpat+in_valfam+in_valami+in_amigcl)/5,
         identity= (in_simili+in_amsimb+in_acpier+in_acadop)/4,
         threat = as.numeric(in_amreal),
         ola=as.numeric(ola))

# Hipotesis
h1 <- "ola+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.educ <- "ola*educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.incom <- "ola+educ+quintil1*ola+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h3 <- "ola*dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.know <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4*ola+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.friend <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4*ola+pos_id+edad+dif_inm+nation_t1+cuestion_mig"

# I. Adpot chilean customs
adopt.null <- lmer(formula(paste0("in_acpier~","1 + (1|idencuesta)+(1|comuna)")),data = df_study1)
adopt1 <- lmer(formula(paste0("in_acpier~",h1,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
adopt2.ed <- lmer(formula(paste0("in_acpier~",h2.educ,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
adopt2.in <- lmer(formula(paste0("in_acpier~",h2.incom,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
adopt3 <- lmer(formula(paste0("in_acpier~",h3,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
adopt4.kno <- lmer(formula(paste0("in_acpier~",h4.know,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
adopt4.fri <- lmer(formula(paste0("in_acpier~",h4.friend,"+(1|idencuesta)+(1|comuna)")),data = df_study1)

omit <- "(pos_id)|(edad)|(cuestion_mig)|(nation_t1)|(quintil1QNA)|(Intercept)"
texreg::knitreg(list(adopt1,adopt2.ed,adopt2.in,adopt3,adopt4.fri,adopt4.kno),
          omit.coef = omit)
```

## Identity (average)

```{r identity}
rm(list=ls())
if (!require("pacman")) install.packages("pacman") # instalar pacman
                            # cargar librerias
pacman::p_load(dplyr,       # Manipulacion de datos
               knitr,
               kableExtra,
               summarytools,
               lme4,
               texreg
               )
load(file = here::here("input/data-proc/df_study_t5_ind_comunas.RData"))

# generate analytical sample
df_study1 <- 
  df_study_long_t5_comunas %>%
  select(idencuesta,ola,comuna,cuestion_mig,in_simpat:edad,inm_prop_cas17_w,inm_prop_cas20_w,dif_inm) %>% 
  na.omit() %>% 
  mutate(conviviality=(in_ansied+in_simpat+in_valfam+in_valami+in_amigcl)/5,
         identity= (in_simili+in_amsimb+in_acpier+in_acadop)/4,
         threat = as.numeric(in_amreal),
         ola=as.numeric(ola)
         )

# Hipotesis
h1 <- "ola+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.educ <- "ola*educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.incom <- "ola+educ+quintil1*ola+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h3 <- "ola*dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.know <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4*ola+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.friend <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4*ola+pos_id+edad+dif_inm+nation_t1+cuestion_mig"

# Identity
ident.null <- lmer(formula(paste0("identity~","1 + (1|idencuesta)+(1|comuna)")),data = df_study1)
ident1 <- lmer(formula(paste0("identity~",h1,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
ident2.ed <- lmer(formula(paste0("identity~",h2.educ,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
ident2.in <- lmer(formula(paste0("identity~",h2.incom,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
ident3 <- lmer(formula(paste0("identity~",h3,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
ident4.kno <- lmer(formula(paste0("identity~",h4.know,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
ident4.fri <- lmer(formula(paste0("identity~",h4.friend,"+(1|idencuesta)+(1|comuna)")),data = df_study1)

omit <- "(pos_id)|(edad)|(cuestion_mig)|(nation_t1)|(quintil1QNA)|(Intercept)"
texreg::knitreg(list(ident1,ident2.ed,ident2.in,ident3,ident4.fri,ident4.kno),
          omit.coef = omit)
```

## J. Unemployment increases

```{r threat}
rm(list=ls())
if (!require("pacman")) install.packages("pacman") # instalar pacman
                            # cargar librerias
pacman::p_load(dplyr,       # Manipulacion de datos
               knitr,
               kableExtra,
               summarytools,
               lme4,
               texreg
               )
load(file = here::here("input/data-proc/df_study_t5_ind_comunas.RData"))

# generate analytical sample
df_study1 <- 
  df_study_long_t5_comunas %>%
  select(idencuesta,ola,comuna,cuestion_mig,in_simpat:edad,inm_prop_cas17_w,inm_prop_cas20_w,dif_inm) %>% 
  na.omit() %>% 
  mutate(conviviality=(in_ansied+in_simpat+in_valfam+in_valami+in_amigcl)/5,
         identity= (in_simili+in_amsimb+in_acpier+in_acadop)/4,
         threat = as.numeric(in_amreal),
         ola=as.numeric(ola)
         )

# Hipotesis
h1 <- "ola+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.educ <- "ola*educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h2.incom <- "ola+educ+quintil1*ola+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h3 <- "ola*dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.know <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4*ola+frien_inm_t1t4+pos_id+edad+dif_inm+nation_t1+cuestion_mig"
h4.friend <- "ola+dif_inm+educ+quintil1+ess+know_inm_t1t4+frien_inm_t1t4*ola+pos_id+edad+dif_inm+nation_t1+cuestion_mig"

# J. Unemployment increases
threat.null <- lmer(formula(paste0("threat~","1 + (1|idencuesta)+(1|comuna)")),data = df_study1)
threat1 <- lmer(formula(paste0("threat~",h1,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
threat2.ed <- lmer(formula(paste0("threat~",h2.educ,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
threat2.in <- lmer(formula(paste0("threat~",h2.incom,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
threat3 <- lmer(formula(paste0("threat~",h3,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
threat4.kno <- lmer(formula(paste0("threat~",h4.know,"+(1|idencuesta)+(1|comuna)")),data = df_study1)
threat4.fri <- lmer(formula(paste0("threat~",h4.friend,"+(1|idencuesta)+(1|comuna)")),data = df_study1)

omit <- "(pos_id)|(edad)|(cuestion_mig)|(nation_t1)|(quintil1QNA)|(Intercept)"
texreg::knitreg(list(threat1,threat2.ed,threat2.in,threat3,threat4.fri,threat4.kno),
          omit.coef = omit)
```
